OKX_API_KEY=fff2ae89-f45f-4e19-a1e8-ab374694f3ef
OKX_API_SECRET=F20AF6C2EDC81DB5FFBA6147FD194621
OKX_API_PASSPHRASE=Wszy1989@

#############################################
# 🧩 1️⃣ 基础运行环境 & 模块开关
#############################################

# 运行环境：development / production
NODE_ENV=development

# 模块启用控制（可按需关闭部分）
ENABLE_COLLECTOR=true       # 开启行情采集模块（K线、OI、Funding等）
ENABLE_FEATURES=true        # 开启特征计算层（指标计算）
ENABLE_MODEL=true           # 开启模型层（打分、AI策略等）
ENABLE_SIGNAL=false         # 开启信号层（策略信号产出）

#############################################
# 🪙 2️⃣ 交易资产与时间粒度
#############################################

# 监控币种列表（英文逗号分隔）
ASSETS=BTC,ETH,LTC,OKB,ICP,DOGE,SOL

# 每根K线的分钟粒度（如1、5、15）
BAR_GRANULARITY_MIN=5

# 初始化抓取历史的分钟范围
FETCH_LOOKBACK_MIN=30

#############################################
# ⏱️ 3️⃣ 定时任务调度（CRON表达式）
#############################################

# 采集器执行周期
CRON_COLLECT=*/1 * * * *

# 特征计算执行周期
CRON_FEATURES=*/1 * * * *

# 模型计算执行周期
CRON_MODEL=*/1 * * * *

# 信号层执行周期
CRON_SIGNAL=*/1 * * * *

# 推荐层（Reco）执行：每分钟第45秒
CRON_RECO=45 * * * * *

# Reco → Order 执行：每分钟第50秒
CRON_RECO_TO_ORDER=50 * * * * *

#############################################
# 🌐 4️⃣ OKX 交易所接口配置
#############################################

OKX_BASE=https://www.okx.com         # OKX API 基础地址
OKX_TIMEOUT_MS=5000                  # 超时时间（毫秒）
OKX_RETRY=3                          # 最大重试次数
OKX_RETRY_BACKOFF_MS=500             # 退避时间（毫秒）

OKX_TDMODE=isolated                  # 仓位模式：isolated(逐仓) 或 cross(全仓)
DEFAULT_LEVERAGE=5                   # 默认杠杆倍数

#############################################
# ⚡ 5️⃣ Redis 实时流配置（事件流/窗口/信号）
#############################################

REDIS_URL=redis://127.0.0.1:6379/0   # Redis 连接地址
REDIS_TTL_DAYS=14                    # 数据过期天数
REDIS_NAMESPACE=quant                # Redis key 命名空间前缀

#############################################
# 🧾 6️⃣ MongoDB 配置（历史持久层）
#############################################

MONGO_URL=mongodb://localhost:27017/quant
MONGO_DB=quant

# 数据存活时间（TTL）
BAR_TTL_DAYS=14                      # bar 数据保存天数
STATUS_TTL_DAYS=7                    # 状态数据保存天数

#############################################
# 📈 7️⃣ Prometheus 监控指标配置
#############################################

METRICS_PORT=9100                    # 指标采集端口
METRICS_PREFIX=quant_                # 指标命名前缀

#############################################
# 🔁 8️⃣ 推荐层（Reco）参数
#############################################

RECO_CONCURRENCY=3                   # 每次tick的并发处理数（建议2~4）
BUILD_RECO_ON_BOOT=1                 # 启动后是否立即跑一轮
TH_UP=0.8                            # 上升信号阈值
TH_DN=-0.8                           # 下降信号阈值
TH_CLOSE=0.15                        # 平仓阈值
DEFAULT_NOTIONAL_USDT=100            # 默认下单名义金额(USDT)

#############################################
# 📦 9️⃣ 下单层（Order）控制
#############################################

CONCURRENCY_SYMBOLS=3                # 同时处理的币种数量
CONCURRENCY_ENDPOINTS=3              # 同时调用的OKX端点数量
JITTER_MS=200                        # 调用随机延迟（毫秒）

#############################################
# 🧮 🔟 Rubik 大数据API调用控制
#############################################

RUBIK_MIN_INTERVAL_MS=120            # Rubik接口最小间隔（毫秒）
RUBIK_ERROR_RETRY=1                  # 错误重试次数
RUBIK_JITTER_MS=200                  # 抖动延迟
RUBIK_BACKOFF_MS=300                 # 退避延时（错误后重试）

#############################################
# 🧠 1️⃣1️⃣ 信号层（Signal）计算逻辑
#############################################

# —— 基础阈值
SIGNAL_TH_UP=0.8
SIGNAL_TH_DN=-0.8

# —— 去抖与平滑
SIGNAL_EMA_BARS=3                    # EMA 平滑窗口（对 score_24h）
SIGNAL_DEADBAND=0.12                 # 中性带：|score| < deadband 时视为无方向
SIGNAL_CONFIRM_BARS=2                # 方向切换需连续K根满足

# —— 行为控制
DRY_RUN=1                            # 1=只记录日志；0=触发实际事件链

#############################################
# 🔄 1️⃣2️⃣ 反手与冷却逻辑（Reversal & Hysteresis）
#############################################

TH_REV_UP=0.9                        # 反手上阈值
TH_REV_DN=-0.9                       # 反手下阈值

HYSTERESIS_OPEN=0.00                 # 开仓超距阈值（防抖）
HYSTERESIS_REVERSE=0.10              # 反手超距阈值

COOLDOWN_BARS=2                      # 冷却bar数量，防止频繁操作
MAX_REVERSES_PER_HOUR=3              # 每小时最多反手次数

# 按币种覆盖阈值 (JSON 字符串)
# 例如：{"ETH-USDT-SWAP":{"TH_UP":0.85,"TH_DN":-0.85,"TH_CLOSE":0.12}}
SYMBOL_THRESHOLDS_JSON={}

#############################################
# 📊 1️⃣3️⃣ 自适应阈值（Adaptive Threshold）
#############################################

TH_ADAPTIVE_ON=1                     # 是否开启自适应阈值
TH_ADAPT_WINDOW=288                  # 自适应计算窗口（例如 288根=1天的5m）
TH_ADAPT_Z=1.0                       # Z-score 系数（越大越保守）

# —— 或采用分位数模式（若设置则优先生效）
# TH_PERC_UP=0.75
# TH_PERC_DN=0.25

#############################################
# 📉 1️⃣4️⃣ 趋势确认与风险控制
#############################################

CONFIRM_BARS=2                       # 趋势需连续确认的bar数
SLOPE_BARS=3                         # 斜率计算窗口
REQUIRE_SLOPE=1                      # 是否启用斜率确认
ACTION_COOLDOWN_MIN=5                # 动作冷却时间（分钟）

NEUTRAL_BARS=3                       # 连续中性bar数才允许Close
CLOSE_REQUIRE_MIN_HOLD=1             # 是否要求最小持仓时间

# 趋势加强（加仓）
BOOST_ON=1
BOOST_MARGIN=0.2          # 分数比阈值更强一点才考虑加仓
BOOST_GAP_SCORE=0.1        # 必须刷新自进场以来的分数新高/新低
BOOST_COOLDOWN_MIN=10      # 两次加仓间隔
BOOST_MAX_PER_TRADE=2      # 一笔最多加仓两次

#############################################
# 💰 1️⃣5️⃣ 资金与下单参数
#############################################

DEFAULT_NOTIONAL_USDT=100            # 默认每次下单的USDT金额

#############################################
# ✅ 结束
#############################################
